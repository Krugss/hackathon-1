<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŸ¬ë„ˆ ëŒ€ì‹œë³´ë“œ - ëŸ°ë‹í¬ì¸íŠ¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë¦¬ì…‹ */
        body, h1, h2, h3, p, ul, li {
            margin: 0;
            padding: 0;
            font-family: 'Noto Sans KR', sans-serif;
            box-sizing: border-box;
        }
        body {
            line-height: 1.6;
            background-color: #f8f8f8;
            color: #333;
        }
        a {
            text-decoration: none;
            color: inherit;
        }

        /* ê³µí†µ ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* í—¤ë” */
        header {
            padding: 1.2rem 0;
            background-color: white;
            border-bottom: 1px solid #eee;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        header .container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        header .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: color 0.3s;
        }
        header .logo:hover {
            color: #3498db;
        }
        header nav {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        header nav a {
            margin: 0 1.2rem;
            color: #555;
            font-weight: 500;
            transition: color 0.3s;
            padding: 0.5rem 0;
        }
        header nav a:hover {
            color: #3498db;
        }
        header nav a.active {
            color: #3498db;
            border-bottom: 2px solid #3498db;
            padding-bottom: 3px;
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-nav {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }
        .tab-nav button {
            padding: 0.8rem 1.5rem;
            background-color: #f0f0f0;
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: background-color 0.3s, border-color 0.3s, color 0.3s;
            color: #555;
        }
        .tab-nav button:hover {
            background-color: #e0e0e0;
        }
        .tab-nav button.active {
            background-color: #3498db;
            color: white;
            border-color: #3498db;
        }

        /* ë©”ì¸ ì½˜í…ì¸  */
        main {
            padding: 3rem 0;
            min-height: calc(100vh - 200px);
        }

        /* ëŒ€ì‹œë³´ë“œ ì¹´ë“œ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        .dashboard-card {
            background-color: white;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        .dashboard-card .icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        .dashboard-card h3 {
            font-size: 1rem;
            color: #555;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        .dashboard-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #3498db;
        }

        /* ì•¡ì…˜ ë²„íŠ¼ */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        .action-card {
            background-color: white;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
            border: 2px solid transparent;
        }
        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            border-color: #3498db;
        }
        .action-card .icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }
        .action-card h3 {
            font-size: 1.4rem;
            margin-bottom: 0.8rem;
            color: #2c3e50;
            font-weight: 600;
        }
        .action-card p {
            color: #7f8c8d;
            font-size: 0.95rem;
        }

        /* í¼ ì„¹ì…˜ */
        .form-section {
            background-color: white;
            padding: 3rem;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .form-section h2 {
            font-size: 1.8rem;
            margin-bottom: 2rem;
            color: #2c3e50;
            font-weight: 600;
        }

        /* í¼ ê·¸ë£¹ */
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 500;
        }
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            font-family: 'Noto Sans KR', sans-serif;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            outline: none;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        .form-group input[readonly] {
            background-color: #f5f5f5;
            cursor: pointer;
        }

        /* ê·¸ë¦¬ë“œ í¼ */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        /* ë²„íŠ¼ */
        button, .btn {
            display: inline-block;
            padding: 0.8rem 1.5rem;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            font-family: 'Noto Sans KR', sans-serif;
        }
        button:hover, .btn:hover {
            background-color: #2980b9;
            transform: translateY(-2px);
        }
        button:disabled, .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        .btn-secondary {
            background-color: #95a5a6;
        }
        .btn-secondary:hover {
            background-color: #7f8c8d;
        }
        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
            overflow-y: auto;
        }
        .modal.show {
            display: block;
        }
        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 2rem;
            border-radius: 12px;
            max-width: 700px;
            width: 90%;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
        }
        .modal-header h2 {
            font-size: 1.5rem;
            color: #2c3e50;
            margin: 0;
        }
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #555;
            padding: 0;
            width: 30px;
            height: 30px;
        }
        .modal-close:hover {
            color: #3498db;
        }

        /* ì§€ë„ ì»¨í…Œì´ë„ˆ */
        .map-container {
            width: 100%;
            height: 400px;
            border-radius: 8px;
            border: 1px solid #ddd;
            margin-bottom: 1.5rem;
            background-color: #e0e0e0;
        }

        /* ì½”ìŠ¤ ì¹´ë“œ */
        .course-card {
            background-color: white;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .course-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        .course-card h3 {
            font-size: 1.2rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        .course-card .meta {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin-bottom: 0.5rem;
        }
        .course-card .stats {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        .course-card .stat {
            font-size: 0.9rem;
            color: #555;
        }
        .course-card .stat strong {
            color: #3498db;
        }

        /* ë©”ì‹œì§€ */
        .message {
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            text-align: center;
            font-weight: 500;
        }
        .message.error {
            background-color: #fee;
            color: #c33;
            border: 1px solid #fcc;
        }
        .message.success {
            background-color: #efe;
            color: #3c3;
            border: 1px solid #cfc;
        }
        .message.info {
            background-color: #eef;
            color: #33c;
            border: 1px solid #ccf;
        }

        /* í‘¸í„° */
        footer {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
        }
        footer p {
            margin: 0.5rem 0;
            font-size: 0.9rem;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .action-buttons {
                grid-template-columns: 1fr;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
            header .container {
                flex-direction: column;
            }
            header nav {
                justify-content: center;
            }
            header nav a {
                margin: 0 0.8rem;
            }
        }

    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=6d1ccd4024313b8160755651625dd7ba&libraries=services"></script>
</head>
<body>

<header>
    <div class="container">
        <div class="logo" onclick="window.location.href='index.html'">ğŸƒ ëŸ°ë‹í¬ì¸íŠ¸</div>
        <nav>
            <a href="index.html">í™ˆ</a>
            <a href="runner.html" class="active">ëŸ¬ë„ˆ</a>
            <a href="organizer.html">ì£¼ìµœì</a>
            <a href="#" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a>
        </nav>
    </div>
</header>

<main>
    <div class="container">
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('dashboard', event)">ğŸ“Š ëŒ€ì‹œë³´ë“œ</button>
            <button class="tab-btn" onclick="switchTab('courses', event)">ğŸ“ ì½”ìŠ¤ ì¡°íšŒ</button>
            <button class="tab-btn" onclick="switchTab('upload', event)">ğŸ“¤ ì½”ìŠ¤ ì—…ë¡œë“œ</button>
            <button class="tab-btn" onclick="switchTab('ranking', event)">ğŸ† ì£¼ê°„ ë­í‚¹</button>
        </div>

        <!-- ëŒ€ì‹œë³´ë“œ íƒ­ -->
        <div id="dashboard" class="tab-content">
            <div class="dashboard-grid">
                <div class="dashboard-card">
                    <div class="icon">ğŸƒ</div>
                    <h3>ì´ ë‹¬ë¦° ê±°ë¦¬</h3>
                    <div class="value" id="totalDistance">0 km</div>
                </div>
                <div class="dashboard-card">
                    <div class="icon">ğŸ“Š</div>
                    <h3>ì´ ê¸°ë¡</h3>
                    <div class="value" id="totalRecords">0íšŒ</div>
                </div>
                <div class="dashboard-card">
                    <div class="icon">ğŸ”¥</div>
                    <h3>ì´ ì†Œëª¨ ì¹¼ë¡œë¦¬</h3>
                    <div class="value" id="totalCalories">0 kcal</div>
                </div>
            </div>

            <div class="action-buttons">
                <div class="action-card" onclick="switchTab('courses', event)">
                    <div class="icon">ğŸ“</div>
                    <h3>ì½”ìŠ¤ ì°¾ì•„ë³´ê¸°</h3>
                    <p>ë‹¤ë¥¸ ëŸ¬ë„ˆë“¤ì´ ê³µìœ í•œ ë©‹ì§„ ëŸ¬ë‹ ì½”ìŠ¤ë¥¼ ë°œê²¬í•˜ì„¸ìš”</p>
                </div>
                <div class="action-card" onclick="switchTab('upload', event)">
                    <div class="icon">ğŸ¯</div>
                    <h3>ì½”ìŠ¤ ì—…ë¡œë“œ</h3>
                    <p>ìì‹ ì´ ë‹¬ë¦° ì½”ìŠ¤ë¥¼ ì—…ë¡œë“œí•˜ê³  ë‹¤ë¥¸ ëŸ¬ë„ˆë“¤ê³¼ ê³µìœ í•˜ì„¸ìš”</p>
                </div>
            </div>
        </div>

        <!-- ì½”ìŠ¤ ì¡°íšŒ íƒ­ -->
        <div id="courses" class="tab-content" style="display:none;">
            <div class="form-section">
                <h2>ğŸ“ ì½”ìŠ¤ ì¡°íšŒ</h2>
                <div class="form-group">
                    <label for="searchTerm">ì½”ìŠ¤ ê²€ìƒ‰</label>
                    <input type="text" id="searchTerm" placeholder="ì½”ìŠ¤ëª…, í…Œë§ˆ, ë‚œì´ë„ë¡œ ê²€ìƒ‰í•˜ì„¸ìš”" onkeyup="filterCourses()">
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="difficultyFilter">ë‚œì´ë„</label>
                        <select id="difficultyFilter" onchange="filterCourses()">
                            <option value="">ëª¨ë‘</option>
                            <option value="ì´ˆê¸‰">ì´ˆê¸‰</option>
                            <option value="ì¤‘ê¸‰">ì¤‘ê¸‰</option>
                            <option value="ê³ ê¸‰">ê³ ê¸‰</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="themeFilter">í…Œë§ˆ</label>
                        <select id="themeFilter" onchange="filterCourses()">
                            <option value="">ëª¨ë‘</option>
                            <option value="ê³µì›">ê³µì›</option>
                            <option value="ë„ì‹œ">ë„ì‹œ</option>
                            <option value="ìì—°ê²½ê´€">ìì—°ê²½ê´€</option>
                            <option value="ê°•ë³€">ê°•ë³€</option>
                            <option value="ì‚°ì•…">ì‚°ì•…</option>
                        </select>
                    </div>
                </div>
                <div id="messageContainer" style="margin-top: 1.5rem;"></div>
                <div id="coursesList" style="margin-top: 2rem;"></div>
            </div>
        </div>

        <!-- ì½”ìŠ¤ ì—…ë¡œë“œ íƒ­ -->
        <div id="upload" class="tab-content" style="display:none;">
            <div class="form-section">
                <h2>ğŸ“¤ ìƒˆ ì½”ìŠ¤ ì—…ë¡œë“œ</h2>
                
                <!-- ê¸°ë³¸ ì •ë³´ ì…ë ¥ -->
                <div class="form-grid">
                    <div class="form-group">
                        <label for="theme">í…Œë§ˆ *</label>
                        <select id="theme" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ê³µì›">ê³µì›</option>
                            <option value="ë„ì‹œ">ë„ì‹œ</option>
                            <option value="ìì—°ê²½ê´€">ìì—°ê²½ê´€</option>
                            <option value="ê°•ë³€">ê°•ë³€</option>
                            <option value="ì‚°ì•…">ì‚°ì•…</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="difficulty">ë‚œì´ë„ *</label>
                        <select id="difficulty" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì´ˆê¸‰">ì´ˆê¸‰</option>
                            <option value="ì¤‘ê¸‰">ì¤‘ê¸‰</option>
                            <option value="ê³ ê¸‰">ê³ ê¸‰</option>
                        </select>
                    </div>
                </div>

                <!-- ê±°ë¦¬ ì…ë ¥ (AI ìƒì„± ì „ì— ì…ë ¥) -->
                <div class="form-group">
                    <label for="requestDistance">ë‹¬ë¦´ ê±°ë¦¬ (km) *</label>
                    <input type="number" id="requestDistance" placeholder="ê±°ë¦¬ ì…ë ¥ (ì˜ˆ: 10)" step="0.1" min="0.1" required>
                    <small style="color: #7f8c8d; display: block; margin-top: 0.5rem;">ğŸƒ ì›í•˜ëŠ” ëŸ¬ë‹ ê±°ë¦¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (ê¸°ë³¸ê°’: 10km)</small>
                </div>

                <!-- ì‹œì‘ì  ì„ íƒ -->
                <div class="form-group">
                    <label for="startPointInput">ì‹œì‘ì  ì„ íƒ *</label>
                    <input type="text" id="startPointInput" placeholder="í´ë¦­í•˜ì—¬ ì§€ë„ì—ì„œ ì‹œì‘ì ì„ ì„ íƒí•˜ì„¸ìš”" readonly required>
                    <small style="color: #7f8c8d; display: block; margin-top: 0.5rem;">ğŸ“ í´ë¦­í•˜ë©´ ì§€ë„ ëª¨ë‹¬ì´ ì—´ë¦½ë‹ˆë‹¤. ìš°í´ë¦­ìœ¼ë¡œ ì¢Œí‘œë¥¼ ì„¤ì •í•˜ì„¸ìš”.</small>
                </div>

                <!-- AI ê²½ë¡œ ìƒì„± -->
                <div class="form-group">
                    <button type="button" onclick="generateAIRoute()" style="width: 100%; margin: 1.5rem 0;">
                        ğŸ¤– AIë¡œ ê²½ë¡œ ìƒì„±
                    </button>
                </div>

                <!-- ìƒì„±ëœ ê²½ë¡œ ì •ë³´ (AI ìƒì„± í›„ í‘œì‹œ) -->
                <div id="routeInfo" style="display: none; background-color: #f0f4f8; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem;">
                    <p style="color: #3498db; margin-bottom: 1rem;">âœ… ê²½ë¡œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</p>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="courseName">ì½”ìŠ¤ëª… *</label>
                            <input type="text" id="courseName" placeholder="ì˜ˆ: ëŒ€ì „ ë³´ë¬¸ì‚° ê³µì›" required>
                        </div>
                        <div class="form-group">
                            <label for="distance">ê±°ë¦¬ (km) *</label>
                            <input type="number" id="distance" placeholder="ê±°ë¦¬ ì…ë ¥ (ì˜ˆ: 10)" step="0.1" min="0.1" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="courseDescription">ì„¤ëª…</label>
                        <textarea id="courseDescription" placeholder="ì½”ìŠ¤ì— ëŒ€í•œ ì„¤ëª…ì„ ì‘ì„±í•˜ì„¸ìš”"></textarea>
                    </div>
                    <button type="button" onclick="uploadCourse()" style="width: 100%; margin-top: 1rem;">
                        âœ… ì½”ìŠ¤ ì—…ë¡œë“œ
                    </button>
                </div>

                <!-- ê¸°ë³¸ ì•ˆë‚´ ë©”ì‹œì§€ -->
                <div id="uploadGuide" style="background-color: #efe; padding: 1.5rem; border-radius: 8px; border: 1px solid #cfc; color: #3c3;">
                    <p><strong>ğŸ“ ì½”ìŠ¤ ì—…ë¡œë“œ ë°©ë²•:</strong></p>
                    <ol style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>í…Œë§ˆì™€ ë‚œì´ë„ë¥¼ ì„ íƒí•˜ì„¸ìš”</li>
                        <li>ì‹œì‘ì  ì…ë ¥ë€ì„ í´ë¦­í•˜ì—¬ ì§€ë„ì—ì„œ ìš°í´ë¦­ìœ¼ë¡œ ì‹œì‘ì ì„ ì„¤ì •í•˜ì„¸ìš”</li>
                        <li>"AIë¡œ ê²½ë¡œ ìƒì„±" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</li>
                        <li>ìƒì„±ëœ ê²½ë¡œì— ì½”ìŠ¤ëª…ì„ ì…ë ¥í•˜ê³  ì—…ë¡œë“œí•˜ì„¸ìš”</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- ì£¼ê°„ ë­í‚¹ íƒ­ -->
        <div id="ranking" class="tab-content" style="display:none;">
            <div class="form-section">
                <h2>ğŸ† ì£¼ê°„ ì¸ê¸° ì½”ìŠ¤</h2>
                <div id="rankingList"></div>
            </div>
        </div>
    </div>
</main>

<footer>
    <p>Â© 2025 ëŸ°ë‹í¬ì¸íŠ¸. All rights reserved.</p>
    <p>ë§ˆë¼í†¤ ì½”ìŠ¤ ì¶”ì²œ ë° ê³µìœ  í”Œë«í¼</p>
</footer>

<!-- ì‹œì‘ì  ì„ íƒ ëª¨ë‹¬ -->
<div id="startPointModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>ğŸ—ºï¸ ì‹œì‘ì  ì„ íƒ</h2>
            <button class="modal-close" onclick="closeStartPointModal()">&times;</button>
        </div>
        <div id="startPointMap" class="map-container"></div>
        <p style="color: #7f8c8d; margin-bottom: 1rem; text-align: center;">ìš°í´ë¦­ìœ¼ë¡œ ì‹œì‘ì ì„ ì„ íƒí•˜ì„¸ìš”</p>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <button class="btn-secondary" onclick="closeStartPointModal()" style="width: 100%;">ì·¨ì†Œ</button>
            <button class="btn" onclick="confirmStartPoint()" id="confirmBtn" disabled style="width: 100%;">í™•ì¸</button>
        </div>
    </div>
</div>

<!-- ì½”ìŠ¤ ìƒì„¸ ëª¨ë‹¬ -->
<div id="courseDetailModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalCourseName"></h2>
            <button class="modal-close" onclick="closeCourseDetailModal()">&times;</button>
        </div>
        <div id="courseDetailMap" class="map-container"></div>
        <div style="margin-bottom: 1.5rem;">
            <p><strong>í…Œë§ˆ:</strong> <span id="modalTheme"></span></p>
            <p><strong>ë‚œì´ë„:</strong> <span id="modalDifficulty"></span></p>
            <p><strong>ê±°ë¦¬:</strong> <span id="modalDistance"></span> km</p>
            <p><strong>ì„¤ëª…:</strong> <span id="modalDescription"></span></p>
            <p><strong>ì¢‹ì•„ìš”:</strong> <span id="modalLikes">0</span> | <strong>ì¡°íšŒ:</strong> <span id="modalViews">0</span></p>
        </div>
        <button class="btn-secondary" onclick="closeCourseDetailModal()" style="width: 100%;">ë‹«ê¸°</button>
    </div>
</div>

<script>
    const API_BASE_URL = 'http://localhost:8082/api';
    // âœ… ìˆ˜ì •: login.htmlì—ì„œëŠ” 'accessToken'ìœ¼ë¡œ ì €ì¥ë¨
    let token = localStorage.getItem('accessToken') || localStorage.getItem('token');
    let currentCourses = [];
    let allCourses = [];
    let selectedStartPoint = null;
    let startPointMap = null;
    let startPointMarker = null;
    let startPointInfoWindow = null;

    // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
    function logout() {
        // âœ… ëª¨ë“  í† í° í˜•ì‹ ì œê±°
        localStorage.removeItem('accessToken');
        localStorage.removeItem('token');
        localStorage.removeItem('tokenType');
        localStorage.removeItem('userType');
        localStorage.removeItem('username');
        localStorage.removeItem('userId');
        window.location.href = 'login.html';
    }

    // ë¡œê·¸ì¸ ì²´í¬ (ì²˜ìŒ í•œ ë²ˆë§Œ, í˜ì´ì§€ ë¡œë“œ ì§í›„ ì²´í¬ - ë¬´í•œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë°©ì§€)
    if (!token) {
        console.warn('âš ï¸ í† í°ì´ ì—†ìŠµë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™...');
        // í•œ ë²ˆë§Œ ë¦¬ë‹¤ì´ë ‰íŠ¸ (ì¦‰ì‹œ ì‹¤í–‰)
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                window.location.href = 'login.html';
            });
        } else {
            window.location.href = 'login.html';
        }
    }

    // ì •ìƒì ì¸ í˜ì´ì§€ ì´ˆê¸°í™”
    window.addEventListener('load', function() {
        console.log('âœ… í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
        // ì´ˆê¸° ëŒ€ì‹œë³´ë“œ ë°ì´í„° ë¡œë“œ
        initializeDashboard();
        
        // ì‹œì‘ì  ì…ë ¥ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
        console.log('ğŸ”§ í˜ì´ì§€ ì´ˆê¸°í™” - ì‹œì‘ì  ë¦¬ìŠ¤ë„ˆ ë“±ë¡ ì¤‘...');
        initStartPointListener();
    });

    // íƒ­ ì „í™˜ í•¨ìˆ˜
    function switchTab(tabName, e) {
        if (e) {
            e.preventDefault();
        }
        
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.style.display = 'none';
        });
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        
        document.getElementById(tabName).style.display = 'block';
        if (e && e.target) {
            e.target.classList.add('active');
        }

        // íƒ­ë³„ ì´ˆê¸°í™”
        if (tabName === 'courses') {
            loadCourses();
        } else if (tabName === 'ranking') {
            loadRanking();
        }
    }

    // ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
    function initializeDashboard() {
        document.getElementById('totalDistance').textContent = '125.5 km';
        document.getElementById('totalRecords').textContent = '24íšŒ';
        document.getElementById('totalCalories').textContent = '8,750 kcal';
    }

    // ì½”ìŠ¤ ë¡œë“œ
    async function loadCourses() {
        try {
            console.log('ğŸ“ ì½”ìŠ¤ ì¡°íšŒ ì‹œì‘...');
            const response = await fetch(`${API_BASE_URL}/runner/courses/my`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (!response.ok) {
                throw new Error('ì½”ìŠ¤ ë¡œë“œ ì‹¤íŒ¨: ' + response.status);
            }

            const data = await response.json();
            console.log('ğŸ“ ë¡œë“œëœ ì½”ìŠ¤ ë°ì´í„°:', data);
            
            // ì‘ë‹µì´ ë°°ì—´ì´ ì•„ë‹ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì²˜ë¦¬
            allCourses = Array.isArray(data) ? data : (data.data || []);
            
            // ì¢Œí‘œê°€ ì—†ëŠ” ì½”ìŠ¤ í•„í„°ë§
            allCourses = allCourses.filter(course => 
                course.coordinates && 
                course.coordinates.length > 0
            );
            
            console.log('âœ… í•„í„°ë§ëœ ì½”ìŠ¤ ìˆ˜:', allCourses.length);
            displayCourses(allCourses);
        } catch (error) {
            console.error('âŒ ì½”ìŠ¤ ë¡œë“œ ì˜¤ë¥˜:', error);
            showMessage('ì½”ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error', 'messageContainer');
        }
    }

    // ì½”ìŠ¤ í•„í„°ë§
    function filterCourses() {
        const searchTerm = document.getElementById('searchTerm').value.toLowerCase();
        const difficulty = document.getElementById('difficultyFilter').value;
        const theme = document.getElementById('themeFilter').value;

        let filtered = allCourses.filter(course => {
            const matchesSearch = !searchTerm || 
                course.courseName.toLowerCase().includes(searchTerm) ||
                course.theme.toLowerCase().includes(searchTerm);
            const matchesDifficulty = !difficulty || course.difficultyLevel === difficulty;
            const matchesTheme = !theme || course.theme === theme;
            return matchesSearch && matchesDifficulty && matchesTheme;
        });

        displayCourses(filtered);
    }

    // ì½”ìŠ¤ í‘œì‹œ
    function displayCourses(courses) {
        const coursesList = document.getElementById('coursesList');
        
        if (courses.length === 0) {
            coursesList.innerHTML = '<p style="color: #7f8c8d; text-align: center; padding: 2rem;">ì½”ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        coursesList.innerHTML = courses.map(course => `
            <div class="course-card" onclick="showCourseDetail(${course.id})">
                <h3>${course.courseName}</h3>
                <div class="meta">${course.theme} â€¢ ${course.difficultyLevel}</div>
                <div class="stats">
                    <div class="stat">ğŸ“ <strong>${course.distance}</strong> km</div>
                    <div class="stat">â¤ï¸ <strong>${course.likeCount || 0}</strong></div>
                    <div class="stat">ğŸ‘ï¸ <strong>${course.viewCount || 0}</strong></div>
                </div>
            </div>
        `).join('');
    }

    // ì½”ìŠ¤ ìƒì„¸ í‘œì‹œ
    function showCourseDetail(courseId) {
        console.log('ğŸ—ºï¸ ì½”ìŠ¤ ìƒì„¸ ì¡°íšŒ: courseId =', courseId);
        const course = allCourses.find(c => c.id == courseId);
        
        if (!course) {
            console.error('âŒ ì½”ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:', courseId);
            alert('ì½”ìŠ¤ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            return;
        }

        console.log('âœ… ì½”ìŠ¤ ë°ì´í„°:', course);

        // ëª¨ë‹¬ ì •ë³´ ì—…ë°ì´íŠ¸
        document.getElementById('modalCourseName').textContent = course.courseName || 'ì´ë¦„ ì—†ìŒ';
        document.getElementById('modalTheme').textContent = course.theme || 'í…Œë§ˆ ì—†ìŒ';
        document.getElementById('modalDifficulty').textContent = course.difficultyLevel || 'ë‚œì´ë„ ì—†ìŒ';
        document.getElementById('modalDistance').textContent = course.distance || '0';
        document.getElementById('modalDescription').textContent = course.description || 'ì„¤ëª… ì—†ìŒ';
        document.getElementById('modalLikes').textContent = course.likeCount || 0;
        document.getElementById('modalViews').textContent = course.viewCount || 0;

        // ëª¨ë‹¬ í‘œì‹œ
        const modal = document.getElementById('courseDetailModal');
        modal.classList.add('show');

        // ì§€ë„ í‘œì‹œ (ëª¨ë‹¬ì´ í‘œì‹œëœ í›„ì— ì‹¤í–‰)
        setTimeout(() => {
            console.log('ğŸ—ºï¸ ì§€ë„ ì´ˆê¸°í™” ì‹œì‘');
            displayCourseMap(course);
        }, 200);
    }

    // ì½”ìŠ¤ ì§€ë„ í‘œì‹œ
    function displayCourseMap(course) {
        const container = document.getElementById('courseDetailMap');
        
        try {
            console.log('ğŸ—ºï¸ ì§€ë„ í‘œì‹œ ì‹œì‘');
            console.log('  ì»¨í…Œì´ë„ˆ:', container);
            console.log('  ì½”ìŠ¤:', course);
            
            // Kakao Maps API ë¡œë“œ í™•ì¸
            if (typeof kakao === 'undefined' || !kakao.maps) {
                console.error('âŒ Kakao Maps APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                container.innerHTML = '<p style="color: red; text-align: center;">ì§€ë„ë¥¼ ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            if (!container) {
                console.error('âŒ courseDetailMap ì»¨í…Œì´ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            container.innerHTML = '';
            
            // ì¢Œí‘œ ë°ì´í„° ê²€ì¦
            let coordinates = course.coordinates;
            if (typeof coordinates === 'string') {
                try {
                    coordinates = JSON.parse(coordinates);
                    console.log('âœ… JSON íŒŒì‹±ëœ ì¢Œí‘œ:', coordinates);
                } catch (e) {
                    console.error('âŒ ì¢Œí‘œ íŒŒì‹± ì‹¤íŒ¨:', e);
                    coordinates = [];
                }
            }

            if (!coordinates || !Array.isArray(coordinates) || coordinates.length === 0) {
                console.error('âŒ ìœ íš¨í•œ ì¢Œí‘œê°€ ì—†ìŠµë‹ˆë‹¤.');
                container.innerHTML = '<p style="color: red; text-align: center;">ì§€ë„ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            console.log('âœ… ì¢Œí‘œ ìˆ˜:', coordinates.length);
            
            // ì¤‘ì‹¬ ì¢Œí‘œ (ì‹œì‘ì  ë˜ëŠ” ì²« ì¢Œí‘œ)
            let centerLat = course.startPointLat || null;
            let centerLng = course.startPointLng || null;

            // ì‹œì‘ì ì´ ì—†ìœ¼ë©´ ì²« ì¢Œí‘œ ì‚¬ìš©
            if (!centerLat || !centerLng) {
                const firstCoord = coordinates[0];
                if (Array.isArray(firstCoord)) {
                    centerLat = firstCoord[0];
                    centerLng = firstCoord[1];
                } else {
                    centerLat = firstCoord.lat;
                    centerLng = firstCoord.lng;
                }
                console.log('âœ… ì²« ì¢Œí‘œ ì‚¬ìš©: ', centerLat, centerLng);
            }

            centerLat = centerLat || 36.3504;
            centerLng = centerLng || 127.3845;

            console.log('ğŸ—ºï¸ ì§€ë„ ì¤‘ì‹¬:', centerLat, centerLng);

            const mapOption = {
                center: new kakao.maps.LatLng(centerLat, centerLng),
                level: 5
            };

            const map = new kakao.maps.Map(container, mapOption);
            console.log('âœ… ì§€ë„ ìƒì„±ë¨');

            // ê²½ë¡œ í‘œì‹œ
            const path = coordinates.map(coord => {
                if (Array.isArray(coord)) {
                    return new kakao.maps.LatLng(coord[0], coord[1]);
                } else {
                    return new kakao.maps.LatLng(coord.lat, coord.lng);
                }
            });

            console.log('âœ… ê²½ë¡œ í¬ì¸íŠ¸ ìˆ˜:', path.length);

            const polyline = new kakao.maps.Polyline({
                path: path,
                strokeWeight: 5,
                strokeColor: '#3498db',
                strokeOpacity: 0.8,
                strokeStyle: 'solid'
            });
            polyline.setMap(map);
            console.log('âœ… í´ë¦¬ë¼ì¸ í‘œì‹œë¨');

            // ì‹œì‘ì  ë§ˆì»¤
            if (path.length > 0) {
                const startMarker = new kakao.maps.Marker({
                    position: path[0],
                    title: 'ì‹œì‘ì '
                });
                startMarker.setMap(map);
                console.log('âœ… ì‹œì‘ì  ë§ˆì»¤ ì¶”ê°€ë¨');
            }

            // ëì  ë§ˆì»¤
            if (path.length > 1) {
                const endMarker = new kakao.maps.Marker({
                    position: path[path.length - 1],
                    title: 'ëì '
                });
                endMarker.setMap(map);
                console.log('âœ… ëì  ë§ˆì»¤ ì¶”ê°€ë¨');
            }

            // ê²½ê³„ ì„¤ì •ìœ¼ë¡œ ëª¨ë“  ê²½ë¡œ í‘œì‹œ
            const bounds = new kakao.maps.LatLngBounds();
            path.forEach(point => bounds.extend(point));
            map.setBounds(bounds);
            console.log('âœ… ê²½ê³„ ì„¤ì •ë¨, ì§€ë„ í‘œì‹œ ì™„ë£Œ!');

        } catch (error) {
            console.error('âŒ ì§€ë„ í‘œì‹œ ì¤‘ ì˜¤ë¥˜:', error);
            container.innerHTML = '<p style="color: red; text-align: center;">ì§€ë„ í‘œì‹œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>';
        }
    }

    // ì½”ìŠ¤ ìƒì„¸ ëª¨ë‹¬ ë‹«ê¸°
    function closeCourseDetailModal() {
        document.getElementById('courseDetailModal').classList.remove('show');
    }

    // ë­í‚¹ ë¡œë“œ
    async function loadRanking() {
        try {
            console.log('ğŸ† ë­í‚¹ ë¡œë“œ ì‹œì‘...');
            
            const mockRanking = [
                { id: 1, courseName: 'ëŒ€ì „ ë³´ë¬¸ì‚° ê³µì›', theme: 'ê³µì›', difficultyLevel: 'ì´ˆê¸‰', distance: 8, likeCount: 234, viewCount: 567, startPointLat: 36.3185, startPointLng: 127.4142, coordinates: [{lat: 36.3185, lng: 127.4142}, {lat: 36.3195, lng: 127.4155}, {lat: 36.3210, lng: 127.4170}] },
                { id: 2, courseName: 'ê³µì£¼ ìš°ê¸ˆì¹˜ê³µì›', theme: 'ê³µì›', difficultyLevel: 'ì¤‘ê¸‰', distance: 12, likeCount: 189, viewCount: 445, startPointLat: 36.2870, startPointLng: 127.0745, coordinates: [{lat: 36.2870, lng: 127.0745}, {lat: 36.2885, lng: 127.0760}] },
                { id: 3, courseName: 'ê³„ë£¡ì‚° ë“±ì‚°ë¡œ', theme: 'ì‚°ì•…', difficultyLevel: 'ê³ ê¸‰', distance: 14, likeCount: 456, viewCount: 1120, startPointLat: 36.3118, startPointLng: 127.2083, coordinates: [{lat: 36.3118, lng: 127.2083}, {lat: 36.3135, lng: 127.2100}] },
                { id: 4, courseName: 'ëŒ€ì „ ê°‘ì²œ ìì „ê±°ê¸¸', theme: 'ê°•ë³€', difficultyLevel: 'ì¤‘ê¸‰', distance: 15, likeCount: 312, viewCount: 789, startPointLat: 36.36, startPointLng: 127.37, coordinates: [{lat: 36.36, lng: 127.37}, {lat: 36.365, lng: 127.375}] },
                { id: 5, courseName: 'ë¶€ì—¬ ë°±ì œë³´ ê°•ë³€', theme: 'ìì—°ê²½ê´€', difficultyLevel: 'ì¤‘ê¸‰', distance: 11, likeCount: 334, viewCount: 756, startPointLat: 36.2913, startPointLng: 126.8850, coordinates: [{lat: 36.2913, lng: 126.8850}, {lat: 36.2928, lng: 126.8865}] }
            ];

            // âœ… allCoursesì— ëª¨ì˜ ë°ì´í„° ì¶”ê°€ (ëª¨ë‹¬ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡)
            allCourses = [...allCourses, ...mockRanking.filter(course => !allCourses.find(c => c.id === course.id))];
            console.log('âœ… allCourses ì—…ë°ì´íŠ¸ë¨ (ì´ ' + allCourses.length + 'ê°œ)');

            const rankingList = document.getElementById('rankingList');
            rankingList.innerHTML = mockRanking.map((course, index) => `
                <div class="course-card" onclick="showCourseDetail(${course.id})">
                    <div style="display: flex; align-items: flex-start; gap: 1rem;">
                        <span style="font-size: 1.5rem; font-weight: 700; color: #3498db; min-width: 40px;">ğŸ¥‡</span>
                        <div style="flex: 1;">
                            <h3>${course.courseName}</h3>
                            <div class="meta">${course.theme} â€¢ ${course.difficultyLevel}</div>
                            <div class="stats">
                                <div class="stat">ğŸ“ <strong>${course.distance}</strong> km</div>
                                <div class="stat">â¤ï¸ <strong>${course.likeCount}</strong></div>
                                <div class="stat">ğŸ‘ï¸ <strong>${course.viewCount}</strong></div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            console.log('âœ… ë­í‚¹ ë¡œë“œ ì™„ë£Œ');
        } catch (error) {
            console.error('âŒ ë­í‚¹ ë¡œë“œ ì˜¤ë¥˜:', error);
        }
    }

    // ì‹œì‘ì  ëª¨ë‹¬ ì—´ê¸°
    function openStartPointModal() {
        document.getElementById('startPointModal').classList.add('show');
        setTimeout(() => {
            initializeStartPointMap();
        }, 100);
    }

    // ì‹œì‘ì  ëª¨ë‹¬ ë‹«ê¸°
    function closeStartPointModal() {
        document.getElementById('startPointModal').classList.remove('show');
        selectedStartPoint = null;
        document.getElementById('confirmBtn').disabled = true;
    }

    // ì‹œì‘ì  ì§€ë„ ì´ˆê¸°í™”
    function initializeStartPointMap() {
        const container = document.getElementById('startPointMap');
        
        if (typeof kakao === 'undefined' || !kakao.maps) {
            console.error('Kakao Maps APIê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
            return;
        }

        container.innerHTML = '';

        const mapOption = {
            center: new kakao.maps.LatLng(36.3504, 127.3845), // ëŒ€ì „ì‹œì²­
            level: 5
        };

        startPointMap = new kakao.maps.Map(container, mapOption);

        // ìš°í´ë¦­ ì´ë²¤íŠ¸ - ì¢Œí‘œ ì„ íƒ
        kakao.maps.event.addListener(startPointMap, 'rightclick', function(mouseEvent) {
            try {
                const latlng = mouseEvent.latLng;
                const lat = latlng.getLat();
                const lng = latlng.getLng();
                
                console.log('âœ… ì§€ë„ì—ì„œ ìš°í´ë¦­ë¨:');
                console.log('  ì¢Œí‘œ:', lat, lng);
                console.log('  íƒ€ì…:', typeof lat, typeof lng);
                
                // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
                if (startPointMarker) {
                    startPointMarker.setMap(null);
                    console.log('  ê¸°ì¡´ ë§ˆì»¤ ì œê±°ë¨');
                }
                if (startPointInfoWindow) {
                    startPointInfoWindow.close();
                    console.log('  ê¸°ì¡´ ì •ë³´ ìœˆë„ìš° ì¢…ë£Œë¨');
                }

                // ìƒˆ ë§ˆì»¤ ì¶”ê°€
                startPointMarker = new kakao.maps.Marker({
                    position: latlng,
                    title: 'ì„ íƒëœ ìœ„ì¹˜',
                    clickable: true
                });
                startPointMarker.setMap(startPointMap);
                console.log('  ìƒˆ ë§ˆì»¤ í‘œì‹œë¨');

                // ì •ë³´ ìœˆë„ìš°
                startPointInfoWindow = new kakao.maps.InfoWindow({
                    content: '<div style="padding: 8px 12px; font-size: 12px; font-weight: bold;">âœ… ìœ„ì¹˜ ì„ íƒë¨<br/>(' + lat.toFixed(4) + ', ' + lng.toFixed(4) + ')</div>'
                });
                startPointInfoWindow.open(startPointMap, startPointMarker);
                console.log('  ì •ë³´ ìœˆë„ìš° í‘œì‹œë¨');

                // âœ… ì„ íƒëœ ì¢Œí‘œ ì €ì¥ (ëª…ì‹œì ì¸ íƒ€ì… í™•ì¸)
                selectedStartPoint = {
                    lat: Number(lat),
                    lng: Number(lng)
                };

                console.log('âœ… selectedStartPoint ì—…ë°ì´íŠ¸ë¨:');
                console.log('  ì €ì¥ëœ ê°’:', selectedStartPoint);
                console.log('  typeof lat:', typeof selectedStartPoint.lat);
                console.log('  typeof lng:', typeof selectedStartPoint.lng);

                // í™•ì¸ ë²„íŠ¼ í™œì„±í™”
                const confirmBtn = document.getElementById('confirmBtn');
                if (confirmBtn) {
                    confirmBtn.disabled = false;
                    confirmBtn.style.opacity = '1';
                    console.log('  í™•ì¸ ë²„íŠ¼ í™œì„±í™”ë¨');
                } else {
                    console.warn('âš ï¸ confirmBtn ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                }
            } catch (error) {
                console.error('âŒ ìš°í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜:', error);
                alert('ì¢Œí‘œ ì„ íƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        });
    }

    // ì‹œì‘ì  í™•ì¸ (ë””ë²„ê¹… í¬í•¨)
    function confirmStartPoint() {
        console.log('âœ… ì‹œì‘ì  í™•ì¸ ë²„íŠ¼ í´ë¦­ë¨');
        console.log('  selectedStartPoint:', selectedStartPoint);
        
        if (!selectedStartPoint || !selectedStartPoint.lat || !selectedStartPoint.lng) {
            alert('âš ï¸ ì‹œì‘ì ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.\n\nì§€ë„ë¥¼ ìš°í´ë¦­í•˜ì—¬ ìœ„ì¹˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            console.warn('âŒ selectedStartPoint ì—†ìŒ:', selectedStartPoint);
            return;
        }
        
        try {
            const coordString = `${selectedStartPoint.lat.toFixed(4)}, ${selectedStartPoint.lng.toFixed(4)}`;
            const startPointInputElement = document.getElementById('startPointInput');
            
            if (startPointInputElement) {
                startPointInputElement.value = coordString;
                console.log('âœ… ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸:', coordString);
            } else {
                console.warn('âš ï¸ startPointInput ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            }
            
            closeStartPointModal();
            console.log('âœ… ëª¨ë‹¬ ì¢…ë£Œ, selectedStartPoint ìƒíƒœ:', selectedStartPoint);
        } catch (error) {
            console.error('âŒ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', error);
            alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
        }
    }

    // ì‹œì‘ì  ì…ë ¥ í´ë¦­ ì´ë²¤íŠ¸ (DOMContentLoadedì™€ ë¶„ë¦¬)
    function initStartPointListener() {
        const startPointInput = document.getElementById('startPointInput');
        if (startPointInput) {
            console.log('âœ… ì‹œì‘ì  ì…ë ¥ ë¦¬ìŠ¤ë„ˆ ë“±ë¡');
            startPointInput.addEventListener('click', function(e) {
                e.preventDefault();
                console.log('ğŸ—ºï¸ ì‹œì‘ì  ëª¨ë‹¬ ì—´ê¸°');
                openStartPointModal();
            });
        } else {
            console.warn('âš ï¸ startPointInput ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
        }
    }

    // AI ê²½ë¡œ ìƒì„± (ì„ íƒëœ ì‹œì‘ì  ì¢Œí‘œ ê¸°ë°˜, ê±°ë¦¬ í¬í•¨) - ìƒì„¸ ë””ë²„ê¹…
    async function generateAIRoute() {
        console.log('ğŸ¤– AI ê²½ë¡œ ìƒì„± í•¨ìˆ˜ ì‹¤í–‰ë¨');
        
        const theme = document.getElementById('theme').value;
        const difficulty = document.getElementById('difficulty').value;
        const requestDistanceInput = document.getElementById('requestDistance').value;
        const startPointInput = document.getElementById('startPointInput');
        const startPoint = startPointInput ? startPointInput.value : '';

        console.log('ğŸ“‹ ì…ë ¥ê°’ í™•ì¸:');
        console.log('  í…Œë§ˆ:', theme, theme ? 'âœ“' : 'âœ—');
        console.log('  ë‚œì´ë„:', difficulty, difficulty ? 'âœ“' : 'âœ—');
        console.log('  ìš”ì²­ ê±°ë¦¬:', requestDistanceInput, requestDistanceInput ? 'âœ“' : 'âœ—');
        console.log('  ì‹œì‘ì  ì…ë ¥:', startPoint, startPoint ? 'âœ“' : 'âœ—');
        console.log('  selectedStartPoint:', selectedStartPoint);

        // 1. ê¸°ë³¸ ì…ë ¥ê°’ ê²€ì¦ (ì‹œì‘ì ì€ ì„ íƒ ì‚¬í•­ìœ¼ë¡œ ë³€ê²½)
        if (!theme || !difficulty) {
            alert('âŒ í…Œë§ˆì™€ ë‚œì´ë„ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }

        if (!requestDistanceInput || parseFloat(requestDistanceInput) <= 0) {
            alert('âŒ ìœ íš¨í•œ ê±°ë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (0kmë³´ë‹¤ ì»¤ì•¼ í•¨)');
            return;
        }

        // âœ… 2. ì‹œì‘ì  - ìˆìœ¼ë©´ ì‚¬ìš©, ì—†ìœ¼ë©´ ê¸°ë³¸ê°’(ëŒ€ì „ì‹œì²­) ì‚¬ìš©
        let startPointLat, startPointLng, startLocationName;
        
        if (selectedStartPoint && selectedStartPoint.lat && selectedStartPoint.lng) {
            startPointLat = selectedStartPoint.lat;
            startPointLng = selectedStartPoint.lng;
            startLocationName = startPoint || `(${startPointLat.toFixed(4)}, ${startPointLng.toFixed(4)})`;
            console.log('âœ… ì„ íƒëœ ì‹œì‘ì  ì‚¬ìš©:', startPointLat, startPointLng);
        } else {
            // ê¸°ë³¸ê°’: ëŒ€ì „ì‹œì²­
            startPointLat = 36.3504;
            startPointLng = 127.3845;
            startLocationName = 'ëŒ€ì „ì‹œì²­';
            console.log('âš ï¸ ì‹œì‘ì  ë¯¸ì„ íƒ â†’ ê¸°ë³¸ê°’ ì‚¬ìš© (ëŒ€ì „ì‹œì²­):', startPointLat, startPointLng);
        }

        const distance = parseFloat(requestDistanceInput);

        try {
            console.log('ğŸš€ Gemini API í˜¸ì¶œ ì‹œì‘:');
            console.log('  API URL:', API_BASE_URL + '/courses/recommend');
            console.log('  í…Œë§ˆ:', theme);
            console.log('  ê±°ë¦¬:', distance + 'km');
            console.log('  ë‚œì´ë„:', difficulty);
            console.log('  ì‹œì‘ì :', startLocationName);
            console.log('  ì¢Œí‘œ:', startPointLat, startPointLng);

            // URL íŒŒë¼ë¯¸í„°ë¡œ ì „ë‹¬ (application/x-www-form-urlencoded)
            const params = new URLSearchParams();
            params.append('theme', theme);
            params.append('distance', distance.toString());
            params.append('startLocation', startLocationName);
            params.append('endLocation', startLocationName);
            params.append('difficulty', difficulty);
            params.append('startPointLat', startPointLat.toString());
            params.append('startPointLng', startPointLng.toString());

            console.log('ğŸ“¤ ìš”ì²­ íŒŒë¼ë¯¸í„°:', params.toString());

            const response = await fetch(`${API_BASE_URL}/courses/recommend`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'Authorization': `Bearer ${token}`
                },
                body: params.toString()
            });

            console.log('ğŸ“¥ ì‘ë‹µ ìƒíƒœ:', response.status, response.statusText);

            const data = await response.json();

            console.log('ğŸ“¥ ì‘ë‹µ ë°ì´í„°:', data);

            if (!response.ok || !data.success) {
                throw new Error(data.error || data.message || `API ì˜¤ë¥˜: ${response.status}`);
            }

            if (!data.data || data.data.length === 0) {
                throw new Error('ìƒì„±ëœ ê²½ë¡œê°€ ì—†ìŠµë‹ˆë‹¤.');
            }

            // ì²« ë²ˆì§¸ ê²½ë¡œ ë°ì´í„° ì‚¬ìš©
            const bestRoute = data.data[0];
            
            console.log('âœ… ê²½ë¡œ ìƒì„± ì„±ê³µ:');
            console.log('  ê²½ë¡œëª…:', bestRoute.name);
            console.log('  ê±°ë¦¬:', bestRoute.distance);
            console.log('  ì¢Œí‘œ ìˆ˜:', bestRoute.coordinates ? bestRoute.coordinates.length : 0);
            
            // ê²½ë¡œ ì •ë³´ í‘œì‹œ
            const generatedDistance = bestRoute.distance || distance;
            document.getElementById('distance').value = generatedDistance;
            document.getElementById('routeInfo').style.display = 'block';
            document.getElementById('uploadGuide').style.display = 'none';

            // ì „ì—­ ë³€ìˆ˜ì— ê²½ë¡œ ë°ì´í„° ì €ì¥ (ì—…ë¡œë“œ ì‹œ ì‚¬ìš©)
            window.generatedRoute = bestRoute;

            showMessage('âœ… ê²½ë¡œê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤! ê±°ë¦¬ë¥¼ í™•ì¸í•˜ê³  ì½”ìŠ¤ëª…ì„ ì…ë ¥í•œ í›„ ì—…ë¡œë“œí•˜ì„¸ìš”.', 'success', null);

        } catch (error) {
            console.error('âŒ AI ê²½ë¡œ ìƒì„± ì˜¤ë¥˜:', error);
            alert('âŒ ê²½ë¡œ ìƒì„± ì‹¤íŒ¨:\n\n' + error.message + '\n\nê°œë°œì ë„êµ¬ ì½˜ì†”ì—ì„œ ë” ìì„¸í•œ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
        }
    }

    // ì½”ìŠ¤ ì—…ë¡œë“œ (ìƒì„±ëœ ê²½ë¡œ ë°ì´í„° ì‚¬ìš©)
    async function uploadCourse() {
        const courseName = document.getElementById('courseName').value.trim();
        const theme = document.getElementById('theme').value;
        const difficulty = document.getElementById('difficulty').value;
        const distanceInput = document.getElementById('distance').value.trim();
        const distance = distanceInput ? parseFloat(distanceInput) : null;
        const description = document.getElementById('courseDescription').value.trim();

        console.log('ğŸ“¤ ì½”ìŠ¤ ì—…ë¡œë“œ ìš”ì²­:');
        console.log('  ì½”ìŠ¤ëª…:', courseName);
        console.log('  ê±°ë¦¬:', distance);
        console.log('  ì‹œì‘ì :', selectedStartPoint);

        // ì…ë ¥ê°’ ê²€ì¦
        if (!courseName) {
            alert('âŒ ì½”ìŠ¤ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        if (!distance || distance <= 0) {
            alert('âŒ ìœ íš¨í•œ ê±°ë¦¬ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (0kmë³´ë‹¤ ì»¤ì•¼ í•¨)');
            return;
        }

        if (!selectedStartPoint || !selectedStartPoint.lat || !selectedStartPoint.lng) {
            alert('âŒ ì‹œì‘ì ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì‹œì‘ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
            console.error('  selectedStartPoint:', selectedStartPoint);
            return;
        }

        if (!window.generatedRoute) {
            alert('âŒ ìƒì„±ëœ ê²½ë¡œê°€ ì—†ìŠµë‹ˆë‹¤. AI ê²½ë¡œ ìƒì„±ì„ ë¨¼ì € ì‹¤í–‰í•´ì£¼ì„¸ìš”.');
            return;
        }

        try {
            console.log('ğŸ“¤ ì½”ìŠ¤ ì—…ë¡œë“œ ìš”ì²­:');
            console.log('  ì½”ìŠ¤ëª…:', courseName);
            console.log('  ì‹œì‘ì :', selectedStartPoint.lat, selectedStartPoint.lng);
            console.log('  ê²½ë¡œ ì¢Œí‘œ ìˆ˜:', window.generatedRoute.coordinates ? window.generatedRoute.coordinates.length : 0);

            const response = await fetch(`${API_BASE_URL}/courses/upload`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    courseName: courseName,
                    theme: theme,
                    difficultyLevel: difficulty,
                    distance: distance,
                    description: description,
                    startPointLat: selectedStartPoint.lat,
                    startPointLng: selectedStartPoint.lng,
                    coordinates: window.generatedRoute.coordinates || [], // AIë¡œ ìƒì„±ëœ ê²½ë¡œ
                    landmarks: window.generatedRoute.landmarks || [],
                    elevationData: window.generatedRoute.elevationGain || 0
                })
            });

            const data = await response.json();

            console.log('ì—…ë¡œë“œ ì‘ë‹µ:', data);

            if (!response.ok) {
                throw new Error(data.message || 'ì½”ìŠ¤ ì—…ë¡œë“œ ì‹¤íŒ¨');
            }

            showMessage('âœ… ì½”ìŠ¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success', null);

            // í¼ ì´ˆê¸°í™”
            setTimeout(() => {
                document.getElementById('theme').value = '';
                document.getElementById('difficulty').value = '';
                document.getElementById('startPointInput').value = '';
                document.getElementById('courseName').value = '';
                document.getElementById('distance').value = '';
                document.getElementById('courseDescription').value = '';
                document.getElementById('routeInfo').style.display = 'none';
                document.getElementById('uploadGuide').style.display = 'block';
                selectedStartPoint = null;
                window.generatedRoute = null;
                loadCourses(); // ì½”ìŠ¤ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
            }, 1500);

        } catch (error) {
            console.error('âŒ ì½”ìŠ¤ ì—…ë¡œë“œ ì˜¤ë¥˜:', error);
            showMessage('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error', null);
        }
    }

    // ë©”ì‹œì§€ í‘œì‹œ
    function showMessage(message, type, containerId) {
        if (containerId) {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = `<div class="message ${type}">${message}</div>`;
            }
        } else {
            alert(message);
        }
    }

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
    window.onclick = function(event) {
        const startPointModal = document.getElementById('startPointModal');
        const courseDetailModal = document.getElementById('courseDetailModal');
        
        if (event.target === startPointModal) {
            closeStartPointModal();
        }
        if (event.target === courseDetailModal) {
            closeCourseDetailModal();
        }
    }

</script>

</body>
</html>
